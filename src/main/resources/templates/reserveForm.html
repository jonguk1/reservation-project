<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>예약 확정</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body class="container mt-5">

<div class="alert alert-warning text-center">
    <strong>재고 선점 완료!</strong><br>
    <span id="limit-timer" class="h4">05:00</span> 내에 결제를 완료해 주세요.<br>
    <small>시간이 초과되면 예약 권한이 자동으로 소멸됩니다.</small>
</div>

<div class="card p-4 shadow-sm">
    <h3>주문 정보를 확인해 주세요</h3>
    <hr>
    <form th:action="@{/reserve/confirm}" method="post">
        <input type="hidden" name="reservationId" th:value="${reservationId}">
        
        <div class="form-group mt-3">
            <label>배송지 정보 (예시)</label>
            <input type="text" class="form-control" placeholder="주소를 입력하세요" required>
        </div>

        <button type="submit" class="btn btn-primary btn-lg btn-block mt-4">
            결제 완료 및 예약 확정
        </button>
    </form>
</div>

<script th:inline="javascript">
    let timeLeft = 300; // 5분
    const timerDisplay = document.getElementById('limit-timer');

    const countdown = setInterval(() => {
        let minutes = Math.floor(timeLeft / 60);
        let seconds = timeLeft % 60;
        
        timerDisplay.innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        
        if (timeLeft <= 0) {
            clearInterval(countdown);
            alert("입력 시간이 초과되어 예약이 취소되었습니다.");
            location.href = '/goods?error=expired';
        }
        timeLeft--;
    }, 1000);

    // [추가] 사용자가 실수로 페이지를 나가는 것을 방지
    window.onbeforeunload = function() {
        if (timeLeft > 0) {
            return "페이지를 벗어나면 선점된 재고가 취소될 수 있습니다.";
        }
    };
</script>
</body>
</html>